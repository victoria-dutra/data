---
title: "Final R markdown 17_01_2023"
author: "Oussama, Julie, Victoria"
date: '`r Sys.Date()`'
output: 
    html_document:
    code_folding: hide           
    highlight: tango             
    toc: yes                    
    toc_depth: 6 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# if (!dir.exists("results")) dir.create("results")  # create folder if necessary
# knitr::opts_chunk$set(              # nice results format
#   fig.path = "results22/",            # Folder for figures
#   dev = "png",                      # png format for figures
#   dev.args = list(type = "cairo"),  # png args. Improves png
#   dpi = 100                         # 100 for working, 300 for publication
# )
# install.packages("readxl", dependencies = TRUE)
# install.packages("ggplot2", dependencies = TRUE)
# install.packages(c("ggplot2", "ggpubr", "tidyverse", "broom", "AICcmodavg"), , dependencies = TRUE)
library(ggplot2)
library(ggpubr)
library(tidyverse)
library(broom)
library(ggplot2)
library(agricolae)
```

#### This file is regarding the results for the water stress green house experiment - Group 5

## Chapter 1 - Downloading the data
> The initial step is the aggregation of all data from the groups (1-5) in a shared Excel file on Google Drive. The dataframe is directly downloaded from GoogleDrive with the package 'gsheet' and named d0. Prior installation of Rtools in the right version of R is necessary to use this package.

```{r}
#install.packages('Rtools') # your version of R may ask you to go to a link and install another version
#install.packages('gsheet') # try with this one or without if it does not work for you
library(gsheet) 
d0 <- gsheet2tbl('https://docs.google.com/spreadsheets/d/1WM6hDgwCFxbLpT37HLzU-iYZAEGBdHP6CpU8BDwWmZc/edit#gid=0', sheet = "Data")
```

> After importing the data, next step is to visualize it, by creating different plots.

## Chapter 2 - Visualization of data with plots. 
> Here we want to create many plots in order to better visualize the data.
We will use X= Date and Y= Variable (Y1= Plant height ; Y2= Leaf number ; Y3= Leaf lenght ; Y4= Leaf width ; Y5= Leaf area ; Y7= Chlorophyll)

**The code used for this step is : 
ggplot(d0, aes(x= Date, y= Plant_height, group= PlantId, color= Treatment)) + 
  geom_line() +
  facet_grid(Species ~.)**
  
  
### Findings:
  > After seeing all the charts, we selected only the ones below because:
  
  > *  we want to make the R markdown file visually appealing by avoiding plotting all variables for all species;
  
  > *  we consider the graphs below representative of the general trends observed in the other species and variables;
  
  > *  we have chosen to analyze the data for week 6, because the effect of the water stress deficit is clearer for this week. 
  
  
> In order to get a better understanding of the variability between weeks, the group chose to explore 2 main graphs for soil parameters. One graph for a cultivated species (Solanum lycopersicum) and another one for a wild species (Lolium perenne). The following chunk is performing the visual representation.

```{r}
# For Solanum lycopersicum

library(viridis) # for aesthetic

s1 <- d0[d0$Species=="Solanum lycopersicum",]
ggplot(s1, aes(x= Week, y= Soil_humidity, group= PlantId, color= Treatment)) + 
  geom_line() +
  labs(title = expression(paste('Figure 1. Evolution of Soil humidity (%) of', italic(' S. lycopersicum'),' on 6 weeks'))) +
  theme_pubclean() +
  scale_color_viridis(discrete = TRUE)
  
# For 	Lolium perenne
s2 <- d0[d0$Species=="Lolium perenne",]
ggplot(s2, aes(x= Week, y= Soil_humidity, group= PlantId, color= Treatment)) + 
  geom_line() +
  labs(title = expression(paste('Figure 2. Evolution of Soil humidity (%) of', italic(' Lolium perenne'), ' on 6 weeks'))) +
  theme_pubclean() +
  scale_color_viridis(discrete = TRUE)
```

### Interpretation Fig1 and Fig2:

> It is visible in both graphs that at week 6 shows the most contrast between treatments (control, intermediate, and water stress). The wild species seems to reduce its humidity in a steadier pace than the cultivated species. On the other hand, the soil humidity of S. lycopersicum dropped sharply following the treatments intermediate and stress. 

> The next code chunk is meant to help visualize the pattern we have by taking only the variable "Plant_height" and the species Raphanus sativus. This species was the most representative species to assess the plant height by treatment, and the plant height appeared to be the best variable to extrapolate the stress level of the plant.

```{r}
# For 	Raphanus sativus

s3 <- d0[d0$Species=="Raphanus sativus",]
ggplot(s3, aes(x= Week, y= Plant_height, group= PlantId, color= Treatment)) + 
  geom_line() +
  labs(title = expression(paste('Figure 3. Evolution of Plant height (cm) of ', italic('Raphanus sativus'), ' on 6 weeks'))) +
  theme_pubclean() +
  scale_color_viridis(discrete = TRUE)
```

### Interpretation Fig3:

> It appears that the treatment has an influence on the height of the plant. In week 2 we can see the difference clearly between the well-watered and the water-stressed plants where the plant height is increasing in control and intermediate but decreasing under stress conditions. The following weeks evolution depends a lot on the repetition, and the variability belong them is high. Week 6 is determining the influence of the treatment on radish growth: it will peak above 20cm for the well-watered plants, between 15 and 20cm for the intermediate treated plants, and on average 15cm for the water-stressed plants.

> For the third part of this project, we will advance with statistical analyses. For this we will use multiple packages including "ggplot2", "ggpubr", "tidyverse", "broom" and "AICcmodavg". Now that we have seen all the variables and the difference for species over time, as we will focus on Week 6 because it appears to be the deciding week.

# Chapter 3 - ANOVA

> To compare the mean values of more than two groups we use an ANOVA (Analyse of Variance). Notice that to do so we made three assumptions on the data: (1) the responses for each factor level have a normal population distribution, (2) these distributions have the same variance, (3) the data are independent. 

> First the ANOVA uses a linear model and so in R it needs the function lm() to perform. Next the ANOVA will need a test of significance - in addition to the ANOVA test - to determine the relationship between the sets of data. Here the Tukey HSD ("honest significant difference") test will specify (with letters) the pair of data that causes the difference. 

## Linear model 

>  We are going to present every variable that we selected to compare all species. Those 12 variables are: Soil humidity, Plant height, Leaf number, Leaf length, Leaf width, Leaf area, Chlorophyll content, Aerial fresh weight, Aerial dry weight, Root length, Roots fresh weight, Roots dry weight.

### Soil_humidity

> The following code chunk will by a for loop: (1) give the ANOVA table, (2) perform the Tukey HSD test, and (3) boxplot the ANOVA for the variable Soil humidity, and all studied species, on the Week 6.

```{r, fig.width=10}
#performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Soil_humidity") ]
d1 <- na.exclude(d1) 
lm1 <- lm(Soil_humidity ~ Treatment + Species, data=d1)
anova(lm1)


# Performing the Tukey HSD analysis

rl <- length(levels(as.factor(d0$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d0$Species))) {
  

d2 <- d1[d1$Species == i,]

model <- aov(Soil_humidity~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3  
}


# plotting the ANOVA results

ggplot(d1, aes(x= Treatment, y= Soil_humidity, fill= Species)) + 
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0.1)) +
  geom_text(data =df0 , aes(y =max(d1$Soil_humidity) , label = Letters))+
   theme_pubclean()+
  labs(title = 'Boxplot 01. Effect of water deficit treatments on the soil humidity (%) of the different species.')
```

> The first boxplot shows that the treatments affect significantly all the species' soil. The difference in humidity is considerably visible for most of the species, with the biggest difference between treatment c (control) and treatment s (stress), especially for Hordeum vulgare and Lolium perenne. Whereas Beta vulgaris and Sonchus oleraceus show the the smallest gap between treatments on soil humidity. Notice that the soil humidity of Amaranthus retroflexus and Spinaca oleraceae have similar pattern but also high variability inside their repetitions. 

### Plant_height

> The same analysis will be now perform for the variable Plant height, to compare all the species, on the Week 6.

```{r, fig.width=10, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}

#performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Plant_height") ]
d1 <- na.exclude(d1) #remove the ones with empty cells 
lm1 <- lm(Plant_height ~ Treatment + Species, data=d1)
anova(lm1)


# Performing  Tukey HSD analysis

# the objective here is create a table using a for loop function, and fill it with the results of Tukey HSD (letters), and automatically assign these letters to the box plots for each species. 

rl <- length(levels(as.factor(d0$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d0$Species))) {
  

d2 <- d1[d1$Species == i,]

model <- aov(Plant_height~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3  
}


# plotting the ANOVA results

ggplot(d1, aes(x= Treatment, y= Plant_height, fill= Species)) + 
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0)) +
  geom_text(data =df0 , aes(y =max(d1$Plant_height) , label = Letters))+
   theme_pubclean()+
  labs(title = 'Boxplot 02. Effect of water deficit on the plant height (cm) of the different species.')         

```

> Two main patterns appear here. On one hand, the species that are not significantly affected but the treatment, those are: A. retroflexus, Beta vulgaris, Lolium perenne, Portulaca oleracea and Sonchus oleraceus, and they are all wild species except Beta vulgaris. On the other hand, they are all cultivated species and show a significant decrease of the growth under water deficit conditions, those are: Hordeum vulgare, Raphanus sativus, Solanum lycopersicum and Spinacia oleracea. 

### Leaf_number

> The graph for the variable Leaf number is showing below:

```{r, fig.width=10, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}
#performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Leaf_number") ]
d1 <- na.exclude(d1) 
lm1 <- lm(Leaf_number ~ Treatment + Species, data=d1)
anova(lm1)


# Performing  Tukey HSD analysis

rl <- length(levels(as.factor(d0$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d0$Species))) {
  

d2 <- d1[d1$Species == i,]

model <- aov(Leaf_number~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3  
}


# plotting the ANOVA results

ggplot(d1, aes(x= Treatment, y= Leaf_number, fill= Species)) + 
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0)) +
  geom_text(data =df0 , aes(y = max(d1$Leaf_number), label = Letters))+
  theme_pubclean()+
  labs(title = 'Boxplot 03. Effect of water deficit on the leaf number of the different species.')

```

> On the Boxplot 03, cultivated species are decreasing their number of leaves with the deficit of water represented by the treatment s (stress), expect for S. oleracea. Also, in average there are no significant change between the control (c) and the intermediate (i) concerning Beta vulgaris. The wild species are not showing significant difference except for Sonchus oleraceus between the control (c) and the two other treatments i.e. intermediate (n) and water stress (s).

### Leaf_length

> The same analyse is done for the variable Leaf length and is shown by the following graph:

```{r, fig.width=10, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}
#performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Leaf_length") ]
d1 <- na.exclude(d1) 
lm1 <- lm(Leaf_length ~ Treatment + Species, data=d1)
anova(lm1)


# Performing  Tukey HSD analysis

rl <- length(levels(as.factor(d0$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d0$Species))) {
  

d2 <- d1[d1$Species == i,]

model <- aov(Leaf_length~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3  
}


# plotting the ANOVA results

ggplot(d1, aes(x= Treatment, y= Leaf_length, fill= Species)) + 
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0)) +
  geom_text(data =df0 , aes(y = max(d1$Leaf_length), label = Letters))+
  theme_pubclean()+
  labs(title = 'Boxplot 04. Effect of water deficit  on the leaf lenght (cm) of the different species.')
```

> The Boxplot 04 above represents well the morphological differences of the species at all levels of water supply. The sepcies the most affected by the treatments is R. sativus. The latter highlights the decrease in leaf length in intermediate and in stress treatments. Other species are slightly impact byt the treatments i or s compared to the control, like Amaranthus retroflexus, Portulaca oleracea, Solanum lycopersicum and Spinaca oleracea.

### Leaf_width

> Leaf width variable is presented below.

```{r, fig.width=10, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}
#performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Leaf_width")]
d1 <- na.exclude(d1) 
lm1 <- lm(Leaf_width ~ Treatment + Species, data=d1)
anova(lm1)


# Performing  Tukey HSD analysis

rl <- length(levels(as.factor(d0$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d0$Species))) {
  

d2 <- d1[d1$Species == i,]

model <- aov(Leaf_width~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3  
}


# plotting the ANOVA results

ggplot(d1, aes(x= Treatment, y= Leaf_width, fill= Species)) + 
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0)) +
  geom_text(data =df0 , aes(y = max(d1$Leaf_width), label = Letters))+
  theme_pubclean()+
  labs(title = 'Boxplot 05. Effect of water deficit  on the leaf width (cm) of the different species.')
```

> The Boxplot 05 is correlating with the Boxplot 05 by showing Raphanus sativus leaf width as the most affected species by both intermediate and stress treatments. The other species experiencing a decrease of their leaf width by one treatment only (i or s) are Amaranthus retroflexus, Portulaca oleracea, Solanum lycopersicum and Spinacia oleracea.

### Leaf_area

> Now the Leaf area of each species is analysed and the graph attached is the following:

```{r, fig.width=10, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}

#performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Leaf_area") ]
d1 <- na.exclude(d1) 
lm1 <- lm(Leaf_area ~ Treatment + Species, data=d1)
anova(lm1)


# Performing  Tukey HSD analysis

rl <- length(levels(as.factor(d0$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d0$Species))) {
  

d2 <- d1[d1$Species == i,]

model <- aov(Leaf_area~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3  
}


# plotting the ANOVA results

ggplot(d1, aes(x= Treatment, y= Leaf_area, fill= Species)) + 
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0)) +
  geom_text(data =df0 , aes(y = max(d1$Leaf_area), label = Letters))+
  theme_pubclean()+
  labs(title = 'Boxplot 06. Effect of water deficit  on the leaf area (%) of the different species.')
```

> The Boxplot 06 is supposedly an extrapolation of the two previous and confirms that R. sativus is the most impacted species by the water deficit. The rest of the species are also not more clearly impacted than the two previous figures, and only two species seem to not be affected by the experiment here. Those species are Hordeum vulgare and Lolium perenne.

### Chlorophyll_content

> Boxplot 07 is presenting the Chlorophyll content of all species at different treatments.

```{r, fig.width=10, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}

# #performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Chlorophyll_content") ]

d1 <- na.exclude(d1)
lm1 <- lm(Chlorophyll_content ~ Treatment + Species, data=d1)
anova(lm1)

# Performing  Tukey HSD analysis
 
rl <- length(levels(as.factor(d1$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d1$Species))) {


d2 <- d1[d1$Species == i,]

model <- aov(Chlorophyll_content~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3
}


# plotting the ANOVA results
 
ggplot(d1, aes(x= Treatment, y= Chlorophyll_content, fill= Species)) +
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0)) +
  geom_text(data =df0 , aes(y = max(d1$Chlorophyll_content), label = Letters))+ 
  theme_pubclean()+
   labs(title = 'Boxplot 07. Effect of water deficit  on the chlorophyll content (SPAD Unit) of the different species.')
```

> There are only 7 compared species here because we could not measure the Chlorophyll content of the species Hordeun vulgare and Lolium perenne due to their too thin leaves. Now what we see in the graph above is interesting but it is probably a not long enough experiement to have significant results. The chlorophyll content significantly increases in R. sativus between the control and the stress. However this content looks to reduce in A. retroflexus and S. lycopersicum. 

### Aerial_fresh_weight

> The Aerial fresh weight is represented by the graph below:

```{r, fig.width=10, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}
#performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Aerial_fresh_weight") ]
d1 <- na.exclude(d1) 
lm1 <- lm(Aerial_fresh_weight ~ Treatment + Species, data=d1)
anova(lm1)


# Performing  Tukey HSD analysis

rl <- length(levels(as.factor(d0$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d0$Species))) {
  

d2 <- d1[d1$Species == i,]

model <- aov(Aerial_fresh_weight~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3  
}


# plotting the ANOVA results

ggplot(d1, aes(x= Treatment, y= Aerial_fresh_weight, fill= Species)) + 
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0)) +
  geom_text(data =df0 , aes(y = max(d1$Aerial_fresh_weight), label = Letters))+
  theme_pubclean()+
  labs(title = 'Boxplot 08. The effect of water deficit  on the aerial fresh weight (g) of the different species.')

```

> Beta vulgaris, Raphanus sativus and Sonchus oleraceus are clearly impacted by the two treatments in deficit of water. Solanum lycopersicum is and Hordeum vulgare are also impacted by mostly by the stress treatment (s). All those species are cultivated species except Sonchus oleraceus, and all will probably decrease in yield if they lack of water, according to this experiment.

### Aerial_dry_weight

> The Boxplot 09 shows the Aerial dry weight of the different species, at the end of the experiment.

```{r, fig.width=10, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}
#performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Aerial_dry_weight") ]
d1 <- na.exclude(d1) 
lm1 <- lm(Aerial_dry_weight ~ Treatment + Species, data=d1)
anova(lm1)


# Performing  Tukey HSD analysis

rl <- length(levels(as.factor(d0$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d0$Species))) {
  

d2 <- d1[d1$Species == i,]

model <- aov(Aerial_dry_weight~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3  
}


# plotting the ANOVA results

ggplot(d1, aes(x= Treatment, y= Aerial_dry_weight, fill= Species)) + 
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0)) +
  geom_text(data =df0 , aes(y = max(d1$Aerial_dry_weight), label = Letters))+
  theme_pubclean()+
  labs(title = 'Boxplot 09. Effect of water deficit  on the aerial dry weight (cm) of the different species.')

```

> It is slightly less obvious in the Boxplot 09 that water scarcity affects the plants, but this analyse is not adapted to every species since they have very different morphologies. Nonetheless, R. sativus data correct with the previous analysis and its aerial dry weight is decreasing with the two treatments i and s. Other than that, Beta vulgaris, Hordeum vulgare, Solanum lycopersicum and Sonchus oleraceus are also showing a significant reduction of aerial dry weight by diminish the water availability. We assume that Portulaca oleracea weight is too small to be interpreted. 

> The Boxplots 10, 11 and 12 will present the root measurements taken after the experiment. 

### Root_length

```{r, fig.width=10, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}
 
# performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Root_length") ]
d1 <- na.exclude(d1)
lm1 <- lm(Root_length ~ Treatment + Species, data=d1)
anova(lm1)

 
# Performing  Tukey HSD analysis
 
rl <- length(levels(as.factor(d0$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d0$Species))) {


d2 <- d1[d1$Species == i,]

model <- aov(Root_length~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3
}


# # plotting the ANOVA results

ggplot(d1, aes(x= Treatment, y= Root_length, fill= Species)) +
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0)) +
  geom_text(data =df0 , aes(y = max(d1$Root_length), label = Letters))+
  theme_pubclean()+
  labs(title = 'Boxplot 10. Effect of water deficit  on the root lenght (cm) of the different species.')

  
```

> Boxplot 09 is showing that the water deficit during this short experiment still has an impact on the root length of some species (Hordeum vulgare and Raphanus sativus). Interestingly while Hordeum vulgare seems to reduce its roots length, Raphanus sativus will increase its root length under water scarcity. It is not significant enough for the other species that water stress influences the root length, in this experiment.

### Roots_fresh_weight

```{r, fig.width=10, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}
#performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Roots_fresh_weight") ]
d1 <- na.exclude(d1) 
lm1 <- lm(Roots_fresh_weight ~ Treatment + Species, data=d1)
anova(lm1)


# Performing  Tukey HSD analysis

rl <- length(levels(as.factor(d0$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d0$Species))) {
  

d2 <- d1[d1$Species == i,]

model <- aov(Roots_fresh_weight~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3  
}


# plotting the ANOVA results

ggplot(d1, aes(x= Treatment, y= Roots_fresh_weight, fill= Species)) + 
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0)) +
  geom_text(data =df0 , aes(y = max(d1$Roots_fresh_weight), label = Letters))+
  theme_pubclean()+
  labs(title = 'Boxplot 11. The effect of water deficit  on the root fresh weight (g) of the different species.')
```

> The Boxplot 11 is showing at the same scale all the studied species of all size of roots. It is only appealing for the cultivated species R. sativus. The latter is clearly showing a drop weight for its fresh roots with the decrease of available water.  There is not a clear pattern among the other species.

### Roots_dry_weight

> The boxplot 12 is taking the dry weight of the root in each treatment for all the studied species in order to see the possible effect of the water stress and compare those responses.

```{r, fig.width=10, echo=FALSE, results = FALSE, message=FALSE, warning=FALSE}
#performing the ANOVA analysis

d1 <- d0[d0$Week == "W6" , c("Treatment", "Species", "Roots_dry_weight") ]
d1 <- na.exclude(d1) 
lm1 <- lm(Roots_dry_weight ~ Treatment + Species, data=d1)
anova(lm1)


# Performing  Tukey HSD analysis

rl <- length(levels(as.factor(d0$Species)))*3  #number of rows

df0 <- data.frame(Treatment = character(), Species = character(), Letters = character())
df0[1:rl,] <- NA
k = 1
i <- levels(as.factor(d0$Species))[1]
for (i in levels(as.factor(d0$Species))) {
  

d2 <- d1[d1$Species == i,]

model <- aov(Roots_dry_weight~Treatment, data =d2 )

hsd <- HSD.test(model, "Treatment")

df0$Treatment[k:(k+2)] <- row.names(hsd$groups)
df0$Species [k:(k+2)] <- i
df0$Letters [k:(k+2)] <- hsd$groups$groups

k <- k+3  
}


# plotting the ANOVA results

ggplot(d1, aes(x= Treatment, y= Roots_dry_weight, fill= Species)) + 
  geom_boxplot(show.legend = FALSE) +
  facet_grid(. ~ Species) +
  theme(strip.text.x = element_text(size=0)) +
  geom_text(data =df0 , aes(y = max(d1$Roots_dry_weight), label = Letters))+
  theme_pubclean()+
  labs(title = 'Boxplot 12. Effect of water deficit  on the root dry weight (g) of the different species.')
```

> By comparing with the previous boxplot, we can see better the possible effect of the treatment on the species. We can see that the weight of dry roots material follows the same patter for R. sativus by decreasing. Also, even though Sonchus oleraceus roots dry weight seems to decrease with the deficit of water, there is no significant difference. Hordeum vulgare confirmed a difference of dry roots weight in this figure. It seems that the water deficit increases the weight of its roots. Indeed, there is a significant difference here between the control and the stress.

> In order to understand better what the influence are of each variables on the development of the plant and determine what variable is the most dominant in this experiment, we are going to conduct a Principal Component Analyse (PCA).

## PCA analysis

> In this part we are going to do a PCA analysis of our data. After that we need to make a subset for the data with only numerical variables and exclude the other variables, scale the data and after that we will exclude all the missing data.

> Then we are going to plot the PCA results.

```{r}

data2 <- d0[d0$Week == "W6", c(11:21)] #
data3 <- na.exclude(data2)

d5 <- d0[d0$Week == "W6", c(4,7, 11:21)]
d6 <- na.exclude(d5)  # we are using this to create an object with species and treatments to use it later in plotting PCA results 

#
PCA_data_scaled1 <- as.data.frame(scale(data3))
PCA <- prcomp(PCA_data_scaled1, scale = FALSE)


# Extract and visualize the eigenvalues/variances of dimensions:

#Eigenvalues correspond to the amount of the variation explained by each principal component (PC).


library(factoextra)
fviz_eig(PCA, addlabels=TRUE)+
  theme_cleveland()


# graph for individuals/variables
# Draw the graph of individuals/variables from the output of Principal Component Analysis (PCA).

fviz_pca_biplot(PCA,
             col.ind = d6$Species,
             label = "var",
             addEllipses = TRUE,
             repel = TRUE) + 
   scale_shape_manual(values=rep(19,7))


# Contribution of the variables to PC 1 (first dimension) :

#  The function fviz_contrib() [in factoextra package] is used to visualize the contributions of rows/columns from the results of Principal Component Analysis (PCA).


fviz_contrib(PCA, choice = "var", axes = 1, top = 5)+
  theme_cleveland()

# Contribution of the variables to PC 2 (second dimension) :

fviz_contrib(PCA, choice = "var", axes = 2, top = 11)+
  theme_cleveland()


# Contribution of the variables to PC 3 (third dimension) :

fviz_contrib(PCA, choice = "var", axes = 3, top = 11)+
  theme_cleveland()


# Contribution of the variables to PC 1 and 2 :

fviz_contrib(PCA, choice = "var", axes = 1:2, top = 11)+
  theme_cleveland()

```





